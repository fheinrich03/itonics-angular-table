<section class="py-6">
    <div class="flex flex-col gap-6 lg:grid lg:grid-cols-[220px_1fr_360px] lg:items-start lg:gap-8">
        <div
            class="border-border/60 bg-background/40 rounded-lg border p-3 lg:mt-1"
            aria-hidden="true"
        >
            <img
                src="/images/milenium-falcon.png"
                alt=""
                class="mx-auto block h-auto w-full max-w-[200px] drop-shadow-2xl lg:max-w-[220px]"
                loading="eager"
                decoding="async"
            />
        </div>

        <div class="min-w-0 self-center">
            <h1 class="mt-2 text-3xl font-bold tracking-tight sm:text-4xl">Starships</h1>
            <p class="text-muted-foreground mt-2 max-w-2xl text-sm sm:text-base">
                Search, sort and infinite-scroll through starships from the Star Wars universe.
            </p>
        </div>

        <div
            class="border-border/70 bg-card/60 text-card-foreground self-end rounded-xl border p-4 shadow-sm lg:w-[360px]"
        >
            <div class="grid grid-cols-2 gap-3 text-sm">
                <div class="border-border/70 bg-background/40 rounded-md border p-3">
                    <div class="text-muted-foreground text-xs">Loaded</div>
                    <div class="mt-1 font-semibold tabular-nums">{{ rowLength() }}</div>
                </div>
                <div class="border-border/70 bg-background/40 rounded-md border p-3">
                    <div class="text-muted-foreground text-xs">Status</div>
                    <div class="mt-1 font-semibold">
                        {{ allStarshipsLoaded() ? 'All Loaded' : 'Browsing' }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    @if (query.isError()) {
        <div
            class="border-destructive/40 bg-destructive/5 text-destructive mt-6 rounded-xl border p-4 shadow-sm"
        >
            <div class="font-semibold">Could not load starships</div>
            <div class="mt-1 text-sm opacity-90">{{ query.error().message }}</div>
            <div class="mt-4">
                <button
                    class="bg-destructive text-destructive-foreground ring-offset-background focus-visible:ring-ring inline-flex items-center justify-center rounded-md px-3 py-2 text-sm font-semibold transition-colors hover:opacity-95 focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:outline-none"
                    (click)="retryInitialLoad()"
                >
                    Retry
                </button>
            </div>
        </div>
    } @else {
        <div class="mt-6">
            <app-table
                [rowData]="rows()"
                (loadMore)="onLoadMore()"
                [isLoading]="isInitialLoading()"
            ></app-table>
        </div>

        @if (allStarshipsLoaded() && rowLength() > 0) {
            <div class="text-muted-foreground mt-3 text-center text-sm">All starships loaded</div>
        }
    }
</section>
